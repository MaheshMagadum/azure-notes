<a href='../index.html'>Back to topics</a><style> #notes_table {	font-family: arial, sans-serif; border-collapse: collapse;  width: 100%; background-color: #ffffff;	color:black;}#notes_table td, #notes_table th { text-align: left; padding: 8px; border: 1px solid #808080;}#notes_table tr:nth-child(even) {background-color: white;}#notes_table tr:hover {	background-color:  #ffffff;}#notes_table tr > th {	background: #f8f8f8; color: black;}</style><table  id='notes_table'><tr align= left><th>Azure CLI</th></ul></td></tr><td><ul><li>The Azure CLI is Microsoft's cross-platform command-line tool for managing Azure resource</li><li>It's available for macOS, Linux, and Windows, or in the browser using Azure Cloud Shell.</li><tr align= left><th>Create a Virtual Machine</th></ul></td></tr><td><ul><li>az vm command</li><li>subcommands</li><li>create, deallocate, delete, list, open-port, restart, show, start, stop, update</li><li>az vm create --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513 --location westus --name SampleVM --image UbuntuLTS --admin-username azureuser --generate-ssh-keys --verbose</li><li>You can add the --no-wait option to tell the Azure CLI tool to return immediately and have Azure continue creating the VM in the background</li><li>This is useful if you're executing the command in a script</li><li>If you omit --admin-username, the az vm create command will use your current user name</li><li>Note that Common names such as "root" and "admin" are not allowed for most images.</li><li>If you already have an SSH key named id_rsa in the target folder, then that SSH key will be used rather than generating a new key.</li><li>it is assigned a public IP address that is reachable over the Internet, and a private IP address used within the Azure data center.</li><li>We don't need a password because we generated an SSH key pair as part of the VM creation</li><tr align= left><th>Explore other VM images</th></ul></td></tr><td><ul><li>az vm list --output table</li><li>az vm image list --sku Wordpress --output table --all</li><li>command to see all images provided by Microsoft -></li><li>az vm image list --publisher Microsoft --output table --all</li><li>Above commands can take few moments to complete</li><tr align= left><th>Location-specific images</th></ul></td></tr><td><ul><li>Some images are only available in certain locations.</li><li>Try adding the --location [location] flag to the command to scope the results</li><li>{'ex': 'az vm image list --location eastus --output table'}</li><tr align= left><th>Sizing VMs properly(Exercise)</th></ul></td></tr><td><ul><li>az vm list-sizes --location eastus --output table</li><li>General purpose ==> Dsv3, Dv3, DSv2, Dv2, DS, D, Av2, A0-7 -> Balanced CPU-to-memory</li><li>Compute optimized ==> Fs, F -> High CPU-to-memory. Good for medium-traffic applications, network appliances, and batch processes.</li><li>Memory optimized ==> Esv3, Ev3, M, GS, G, DSv2, DS, Dv2, D -> High memory-to-core. Great for relational databases, medium to large caches, and in-memory analytics.</li><li>Storage optimized ==> Ls -> High disk throughput and IO. Ideal for big data, SQL, and NoSQL databases.</li><li>GPU optimized ==> NV, NC -> Specialized VMs targeted for heavy graphic rendering and video editing</li><li>High performance ==> H, A8-11 -> Our most powerful CPU VMs with optional high-throughput network interfaces (RDMA).</li><li>We didn't specify a size when we created our VM, so Azure selected a default general-purpose size for us</li><li>Use --size parameter in vm create command</li><li>Ex ==> --size "Standard_DS2_v2" creates a 2-core VM</li><li>Warning ==> Your subscription tier enforces limits on how many resources you can create, as well as the total size of those resources. Quota limits depend upon your subscription type and region</li><tr align= left><th>Resize an existing VM</th></ul></td></tr><td><ul><li>check to see if the desired size is available in the cluster our VM is part of using</li><li>vm list-vm-resize-options</li><li>To resize a VM, we use the vm resize command.</li><tr align= left><th>Query system and runtime information about the VM (Exercise)</th></ul></td></tr><td><ul><li>az vm list -> output is json and difficult to read</li><li>az vm list --output table</li><li>Instead of table, you can specify jsonc (colorized JSON) or tsv (Tab-Seperated Values)</li><tr align= left><th>Get the IP address</th></ul></td></tr><td><ul><li>vm list-ip-addresses</li><li>az vm list-ip-addresses -o table</li><li>az vm list-ip-addresses -n SampleVM -o table</li><tr align= left><th>Get VM details</th></ul></td></tr><td><ul><li>az vm show --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513 --name SampleVM</li><li>az vm show --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513 --name SampleVM -o jsonc</li><li>az vm show --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513 --name SampleVM -o tsv</li><li>All commands work and note that just az vm show does require --resource-group and --name parameters!</li><tr align= left><th>Add filters to queries with JMESPath</th></ul></td></tr><td><ul><li>JMESPath is an industry-standard query language built around JSON objects</li><li>The simplest query is to specify an identifier that selects a key in the JSON object.</li><li>JMESQuery has several other interesting query features. Check more in the below link</li><li>http://jmespath.org/tutorial.html</li><tr align= left><th>Filter your Azure CLI queries</th></ul></td></tr><td><ul><li>With a basic understanding of JMES queries, we can add filters to the data being returned by queries like the vm show command</li><li>az vm show --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513 --name SampleVM --query "osProfile.adminUsername"</li><li>az vm show --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513 --name SampleVM --query "networkProfile.networkInterfaces[].id" -o tsv</li><tr align= left><th>Start and stop your VM with the Azure CLI</th></ul></td></tr><td><ul><li>['Stop VM']</li><li>az vm stop --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513 --name SampleVM</li><li>Note that there will be message output ==> It will continue to be billed. To deallocate a VM, run:- az vm deallocate</li><li>Also use ==> az vm get-instance-view</li><li>Actual/correct command below.</li><li>az vm get-instance-view --name SampleVM --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513 --query "instanceView.statuses[?starts_with(code, 'PowerState/')].displayStatus" -o tsv</li><li>This command should return VM stopped as the output</li><li>['start VM']</li><li>az vm start --name SampleVM --resource-group learn-e1d7b138-a815-41f3-90c8-ac4aeda0a513</li><li>The az vm get-instance-view command now returns output as "VM running"</li><li>['Restart VM']</li><li>az vm restart. you an --no-wait if azure cli has to return immediatly</li><tr align= left><th>Install Software on VM</th></ul></td></tr><td><ul><li>Install NGINX web server</li><li>az vm list-ip-addresses --name SampleVM --output table</li><li>ssh azureuser@20.253.175.217</li><li>sudo apt-get -y update && sudo apt-get -y nginx</li><li>exit</li><li>curl -m 80 <PublicIPAddress></li><li>Above command will fail, because the Linux virtual machine doesn't expose port 80 (http) through the network security group that secures the network connectivity to the virtual machine</li><li>We can fix the failure by running the Azure CLI command vm open-port.</li><li>az vm open-port --port 80 --resource-group learn-0b9bccfc-235e-4c4a-9875-0a7480336e59 --name SampleVM</li><li>It will take a moment to add the network rule and open the port through the firewall.</li><li>Now curl -m 80 <publicIpAddress> returns default web page</li></table><a href='../index.html'>Back to topics</a>