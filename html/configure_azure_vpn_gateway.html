<a href='../index.html'>Back to topics</a><style> #notes_table {	font-family: arial, sans-serif; border-collapse: collapse;  width: 100%; background-color: #ffffff;	color:black;}#notes_table td, #notes_table th { text-align: left; padding: 8px; border: 1px solid #808080;}#notes_table tr:nth-child(even) {background-color: white;}#notes_table tr:hover {	background-color:  #ffffff;}#notes_table tr > th {	background: #f8f8f8; color: black;}</style><table  id='notes_table'><tr align= left><th>Azure VPN Gateway uses</th></ul></td></tr><td><ul><li>A VPN gateway is a specific type of virtual network gateway that's used to send encrypted traffic between your Azure virtual network and an on-premises location over the public internet</li><li>A VPN gateway can also be used to send encrypted traffic between your Azure virtual networks over the Microsoft network.</li><li>Azure VPN Gateway is a service that uses this specific type of virtual network gateway to support encrypted traffic.</li><li>When you implement a VPN gateway, the VPN service intercepts your data and applies encryption before it reaches the internet.</li><li>The VPN service uses a secure pathway (called a VPN tunnel) for movement of your data between your device and the internet.</li><li>A virtual network can have only one VPN gateway.</li><li>When you create multiple connections to the same VPN gateway, all VPN tunnels share the available gateway bandwidth.</li><li>A VPN gateway can be deployed in Azure availability zones to gain resiliency, scalability, and higher availability to virtual network gateways</li><tr align= left><th>Virtual network gateway</th></ul></td></tr><td><ul><li>A virtual network gateway is composed of two or more virtual machines that are deployed to a specific subnet that you create called the gateway subnet.</li><li>The virtual machines are created when you create the virtual network gateway.</li><li>The virtual machines contain routing tables and run specific gateway services.</li><li>You can't directly configure the virtual machines that are part of a virtual network gateway.</li><tr align= left><th>Site-to-site(S2S)</th></ul></td></tr><td><ul><li>Connect your on-premises datacenters to your Azure virtual networks through an IPsec/IKE (IKEv1 or IKEv2) VPN tunnel</li><li>Support cross-premises and hybrid configurations</li><li>Configure S2S VPN and Azure ExpressRoute for the same virtual network</li><li>Configure S2S VPN as a secure failover path for ExpressRoute</li><li>Use S2S VPNs to connect to sites outside your network that are connected through ExpressRoute</li><tr align= left><th>Point-to-site(P2S or User VPN)</th></ul></td></tr><td><ul><li>Connect individual devices to your Azure virtual networks</li><li>Create a secure connection to your virtual network from an individual client computer</li><li>Useful for remote or traveling workers who want to connect to Azure virtual networks from their current location</li><li>Support a few clients that need to connect to a virtual network</li><tr align= left><th>Virtual network to virtual network (VNet-to-VNet)</th></ul></td></tr><td><ul><li>Connect one virtual network to another virtual network through an IPsec/IKE VPN tunnel</li><li>Build a network that integrates cross-premises connectivity with inter-virtual network connectivity by combining VNet-to-VNet communication with multi-site connection configurations</li><li>Connect virtual networks in the same or different regions</li><li>Connect virtual networks in the same or different subscriptions</li><li>Connect virtual networks that have the same or different deployment models</li><tr align= left><th>Highly available</th></ul></td></tr><td><ul><li>Support high availability for cross-premises and VNet-to-VNet connections</li><li>Implement high availability for multiple on-premises VPN devices</li><li>Implement high availability for an active-active Azure VPN gateway</li><li>Implement high availability for a combination of multiple on-premises VPN devices and an active-active Azure VPN gateway</li><tr align= left><th>Create site-to-site connections</th></ul></td></tr><td><ul><li>Take time to carefully plan your network configuration before you begin the implementation</li><li>Identifying your IP addresses before you begin configuration is critical</li><li>Consider a scenario where a duplicate IP address range exists on both sides of your VPN connection. In this case, traffic won't route as expected</li><li>Create a map of IP addresses and ranges to ensure all traffic flows as expected.</li><tr align= left><th>Create the gateway subnet</th></ul></td></tr><td><ul><li>You deploy a gateway in your virtual network by adding a gateway subnet.</li><li>Your gateway subnet must be named GatewaySubnet.</li><li>The gateway subnet contains the IP addresses that are used by your virtual network gateway resources and services.</li><li>When you create your gateway subnet, gateway virtual machines are deployed to the gateway subnet and configured with the required VPN gateway settings.</li><tr align= left><th>Create the VPN gateway</th></ul></td></tr><td><ul><li>Look at /review all inputs while creating VPN gateway like VPN type Route/Policy-based etc</li><tr align= left><th>Determine the VPN gateway type</th></ul></td></tr><td><ul><li>Route-based VPNs use routes in the IP forwarding or routing table to direct packets into their corresponding tunnel interfaces.</li><li>The tunnel interfaces then encrypt or decrypt the packets in and out of the VPN tunnels.</li><li>Most VPN gateway configurations require a route-based VPN.</li><li>Use a route-based VPN when your virtual network coexists with an Azure ExpressRoute gateway, or if you need to use the IKEv2 protocol.</li><li>Policy-based VPNs encrypt and direct packets through IPsec tunnels based on the IPsec policies</li><li>The policies are configured with the combinations of address prefixes between your on-premises network and the Azure virtual network</li><li>A policy-based VPN can be used on the Basic gateway SKU only.</li><li>When you use a policy-based VPN, you can have only one VPN tunnel.</li><li>You can only use policy-based VPNs for S2S connections, and only for certain configurations.</li><tr align= left><th>Determine gateway SKU and generation (GPN Gateway inputs in Azure Portal)</th></ul></td></tr><td><ul><li>1 example here, see for more details</li><li>Generation1 ==> VpnGw1/Az(SKU) Max. 30 (Tunnels) Max. 250(Connections) 650 Mbps(Benchmark)</li><li>etc</li><li>Generation2 == > VpnGw2/Az(SKU) Max. 30(Tunnels) Max. 500(Connections) 1.25 Gbps(Bandwidth)</li><li>etc</li><tr align= left><th>Create the local network gateway</th></ul></td></tr><td><ul><li>The local network gateway typically refers to the on-premises location</li><li>Create in portal, inputs to provide-> Name, Endpoint, IP address, Address space etc</li><li>Do this practically!</li><tr align= left><th>Configure the on-premises VPN device</th></ul></td></tr><td><ul><li>A validated list of standard VPN devices that work well with the VPN gateway is available for developers.</li><li>The list was created in partnership with device manufacturers like Cisco, Juniper, Ubiquiti, and Barracuda Networks.</li><li>Check the list of validated devices to find your device</li><li>To configure your VPN device, you need the following information</li><li>1. A shared key. This key is the same shared ey that you specify when you create the VPN connection</li><li>2. The public IP address of your VPN gateway. The IP address can be new or existing</li><li>Configure scripts are available for some devices.</li><tr align= left><th>Create the VPN connection</th></ul></td></tr><td><ul><li>The last step in the site-to-site connection process is to establish the connection between your VPN gateways</li><li>If you virtual networks are in the same subscription, you can use the Azure portal to create the connection.</li><tr align= left><th>Determine high availability scenarios</th></ul></td></tr><td><ul><li>You can implement a highly available VPN gateway to support cross-premises and VNet-to-VNet connections and configurations with multiple on-premises VPN devices</li><li>In these scenarios, the Azure VPN gateway consists of two instances in an active-standby configuration.</li><li>You can also create an Azure VPN gateway in an active-active configuration</li><li>Read more about Active/Standby and Active/Active of Azure VPN Gateway</li><tr align= left><th>Check</th></ul></td></tr><td><ul><li>How can you enable the VPN gateway to work with Azure ExpressRoute? Implement a policy-based VPN gateway.Implement a route-based VPN gateway.</li><li>Which implementation decision most influences VPN gateway performance? The appropriate Azure VPN Gateway SKU.</li><li>What key piece of information do you need to set up the on-premises VPN gateway? ==> The shared key provided when the site-to-site (S2S) VPN connection was created.</li><tr align= left><th>More</th></ul></td></tr><td><ul><li>https://learn.microsoft.com/en-us/training/modules/connect-on-premises-network-with-vpn-gateway/</li><tr align= left><th>Exersise done in my billing account</th></ul></td></tr><td><ul><li>Implemented point-to-site (p2S) to give access to private IP of the VM present in the virtual network (ubuntu-vnet)</li><li>by creating a virtual network gateway with subnet GatewaySubnet (created by default) and public IP address of the gateway auto created to the given public ip address name (gateway-ip)</li><li>Under point-to-site configuration option of virtual network gateway (network-gateway1), added address pool (for client/laptop) and Tunnel Type IKEv2 and authentication type Azure Certificate</li><li>Add GatewaySubnet and go with default subnet address range. Once saved, you can't add another gateway subnet</li><li>Created self signed Root and Client certs from PowerShell documented at https//learn.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-certificates-point-to-site</li><li>Exported the created Root Cert to a location on windows and copied the key and pasted under Root Certificate section named "Public certification data" of Virtual network gateway with name "root"</li><li>Downloaded 'Download VPN client' from vnet gateway Azure portal and install it on windows.</li><li>Search VPN Settings from win search bar and VPN connection is visible there and click connect. It then gets connected</li><li>Now the client can ping or access website (if present) or do ssh to it with PRIVATE IP (10.0.0.4) and VM does not have public IP address.</li><li>Public IP of VM if it has can be disassociated by navigating to NIC of the VM and clicking ipconfig1 under IP configurations link in Azure</li><li>Delete the virtual network gateway created to avoid charges</li></table><a href='../index.html'>Back to topics</a>