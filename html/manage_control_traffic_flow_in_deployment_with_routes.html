<a href='../index.html'>Back to topics</a><style> #notes_table {	font-family: arial, sans-serif; border-collapse: collapse;  width: 100%; background-color: #ffffff;	color:black;}#notes_table td, #notes_table th { text-align: left; padding: 8px; border: 1px solid #808080;}#notes_table tr:nth-child(even) {background-color: white;}#notes_table tr:hover {	background-color:  #ffffff;}#notes_table tr > th {	background: #f8f8f8; color: black;}</style><table  id='notes_table'><tr align= left><th>Azure routing</th></ul></td></tr><td><ul><li>Network traffic in Azure is automatically routed across Azure subnets, virtual networks, and on-premises networks. This routing is controlled by system routes, which are assigned by default to each subnet in a virtual network.</li><li>Every subnet has the following default system routes</li><li>((Address prefix))            => ((Next hot type))</li><li>Unique to the virtual network => Virtual Network</li><li>0.0.0.0/0                     => Internet</li><li>10.0.0.0/8                    => None</li><li>172.16.0.0/12                 => None</li><li>192.168.0.0/16                => None</li><li>100.64.0.0/10                 => None</li><tr align= left><th>Virtual network peering and service chaining</th></ul></td></tr><td><ul><li>Virtual network peering and service chaining let virtual networks within Azure be connected to one another. With this connection, virtual machines can communicate with each other within the same region or across regions. This communication in turn creates more routes within the default route table.</li><li>Service chaining lets you override these routes by creating user-defined routes between peered networks.</li><li>On-prem resources<=Local network gateway<=Site-to-Site VPN=>Virtual network gateway=>Azure Virtual network</li><li>Virtual network endpoints extend your private address space in Azure by providing a direct connection to your Azure resources. ex. your Azure virtual machines can access your storage account directly from the private address space and deny access from a public virtual machine. As you enable service endpoints, Azure creates routes in the route table to direct this traffic.</li><tr align= left><th>Custom routes (UDR/BGP)</th></ul></td></tr><td><ul><li>You can use a user-defined route to override the default system routes so traffic can be routed through firewalls or NVAs.</li><li>custom => you might have a network with two subnets and want to add a virtual machine in the perimeter network to be used as a firewall. You can create a user-defined route so that traffic passes through the firewall and doesn't go directly between the subnets.</li><li>A virtual appliance next hop type is typically a firewall device used to analyze or filter traffic that is entering or leaving your network. You can specify the private IP address of a NIC attached to a virtual machine so that IP forwarding can be enabled. Or you can provide the private IP address of an internal load balancer.</li><li>The virtual network gateway next hop type is specified as a VPN for the next hop type.</li><li>The vnet next hop type is used to override the default system route within a virtual network.</li><li>Internet next hop type is used to to route traffic to a specified address prefix that is routed to the internet.</li><li>None next hop type is used to drop traffic sent to a specified address prefix</li><li>When creating user-defined routes, you can specify these next hop types=> Virtual applicance, Virtual network gateway, Virtual network, Internet, None</li><li>With user-defined routes, you can't specify the next hop type VirtualNetworkServiceEndpoint, which indicates virtual network peering.</li><li>BGP - A network gateway in your on-premises network can exchange routes with a virtual network gateway in Azure by using BGP</li><li>BGP is used to transfer data and information between different host gateways like on the internet or between autonomous systems.</li><li>You'll typically use BGP to advertise on-premises routes to Azure when you're connected to an Azure datacenter through Azure ExpressRoute.</li><li>You can also configure BGP if you connect to an Azure virtual network by using a VPN site-to-site connection.</li><li>Note=> if a message gets sent to the IP address 10.0.0.2, but two routes are available with the 10.0.0.0/16 and 10.0.0.0/24 prefixes, Azure selects the route with the 10.0.0.0/24 prefix because it's more specific.</li><li>You can't configure multiple user-defined routes with the same address prefix.</li><tr align= left><th>Quick check</th></ul></td></tr><td><ul><li>What is the main benefit of using a network virtual appliance? => To control incoming traffic from the perimeter network and allow only traffic that meets security requirements to pass through.</li><li>How might you deploy a network virtual appliance? => You can configure a Windows virtual machine and enable IP forwarding after routing tables, user-defined routes, and subnets have been updated. Or you can use a partner image from Azure Marketplace.</li><tr align= left><th>Complete this excercise</th></ul></td></tr><td><ul><li>https://learn.microsoft.com/en-us/training/modules/control-network-traffic-flow-with-routes/3-exercise-create-custom-routes?tryIt=true&source=learn&activate-azure-sandbox=true</li><tr align= left><th>NVA (Network Virtual Applicance)</th></ul></td></tr><td><ul><li>NVA consistance of various layers like a firewall, a WAN optimizer, application-delivery controllers, routers, load balancers, IDS/IPS, proxies</li><li>You can deploy NVAs chosen from providers in Azure Marketplace. Such providers include Cisco, Check Point, Barracuda, Sophos, WatchGuard, and SonicWall</li><li>You can implement a secure environment that scrutinizes all incoming traffic and blocks unauthorized traffic from passing on to the internal network.</li><li>Microsegmentation lets the firewall inspect all packets at OSI Layer 4 and, for application-aware appliances, Layer 7. When you deploy an NVA to Azure, it acts as a router that forwards requests between subnets on the virtual network.</li><tr align= left><th>Make cli script commands in Git (TODO)</th></ul></td></tr><td><ul><li>ex - Run the following command to enable IP forwarding within the NVA=> ssh -t -o StrictHostKeyChecking=no azureuser@$NVAIP 'sudo sysctl -w net.ipv4.ip_forward=1; exit;'</li><li>Do exercises in subscription account</li></table><a href='../index.html'>Back to topics</a>